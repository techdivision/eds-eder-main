#!/bin/bash
CONFIG_FILE=".multisite/config.yaml"

# check if yq is installed
if ! command -v yq &> /dev/null
then
    echo "yq could not be found, please install it first."
    exit 1
fi

# read sites from the config file
SITES=$(yq e '.sites | keys' "$CONFIG_FILE" | sed 's/- //g')

# iterate over each site
REPO_NAME=eds-eder-main
echo curl --request POST --url "https://admin.hlx.page/index/techdivision/$REPO_NAME/main/*"
curl --request POST --url "https://admin.hlx.page/index/techdivision/$REPO_NAME/main/*"
printf '%.0s\n' {1..3}

for SITE in $SITES; do
    ORIGIN=$(yq e ".sites.$SITE.origin" "$CONFIG_FILE")
    REPO_NAME=$(basename "$ORIGIN" .git)

    echo curl --request POST --url "https://admin.hlx.page/index/techdivision/$REPO_NAME/main/*"
    curl --request POST --url "https://admin.hlx.page/index/techdivision/$REPO_NAME/main/*"
    printf '%.0s\n' {1..3}
done
