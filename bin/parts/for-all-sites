#!/bin/bash
CONFIG_FILE=".multisite/config.yaml"

# check if yq is installed
if ! command -v yq &> /dev/null
then
    echo "yq could not be found, please install it first."
    exit 1
fi

# read sites from the config file
SITES=$(yq e '.sites | keys' "$CONFIG_FILE" | sed 's/- //g')

# send request for default repository
send_request "eds-eder-main"

# iterate over each site and send request
for SITE in $SITES; do
    ORIGIN=$(yq e ".sites.$SITE.origin" "$CONFIG_FILE")
    REPO_NAME=$(basename "$ORIGIN" .git)

    send_request "$REPO_NAME"
done
