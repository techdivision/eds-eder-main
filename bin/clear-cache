#!/bin/bash
source "$(dirname "$0")/parts/bootstrap"

# get url from argument
if [ -z "$1" ]; then
  echo "Usage: $0 <URL>"
  exit 1
fi

# extract parts from the input URL
INPUT_URL=$1
PATTERN='https:\/\/([a-zA-Z0-9-]+)--([a-zA-Z0-9-]+)--([a-zA-Z0-9-]+)\.hlx\.([a-zA-Z]+)/(.*)'

# check if URL matches the pattern
if [[ $INPUT_URL =~ $PATTERN ]]; then
  URL_SITE="${BASH_REMATCH[1]}"
  URL_BRANCH="${BASH_REMATCH[2]}"
  URL_ORG="${BASH_REMATCH[3]}"
  URL_ENV="page" # "${BASH_REMATCH[4]}"
  URL_PATH="${BASH_REMATCH[5]}"
  URL_METHOD="cache"

  # call API
  TRANSFORMED_URL="https://admin.hlx.${URL_ENV}/${URL_METHOD}/${URL_ORG}/${URL_BRANCH}/${URL_SITE}/${URL_PATH}"
  callAdminApi "$TRANSFORMED_URL"
else
  echo "URL format is not recognized."
  exit 1
fi
